"use strict";(()=>{var _=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports);var M=_((j,k)=>{(function(i,r){typeof j=="object"&&typeof k!="undefined"?r(j):typeof define=="function"&&define.amd?define(["exports"],r):r(i.WHATWGFetch={})})(j,function(i){"use strict";var r=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof r!="undefined"&&r,n={searchParams:"URLSearchParams"in r,iterable:"Symbol"in r&&"iterator"in Symbol,blob:"FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in r,arrayBuffer:"ArrayBuffer"in r};function o(t){return t&&DataView.prototype.isPrototypeOf(t)}if(n.arrayBuffer)var d=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(t){return t&&d.indexOf(Object.prototype.toString.call(t))>-1};function p(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function y(t){return typeof t!="string"&&(t=String(t)),t}function m(t){var e={next:function(){var s=t.shift();return{done:s===void 0,value:s}}};return n.iterable&&(e[Symbol.iterator]=function(){return e}),e}function a(t){this.map={},t instanceof a?t.forEach(function(e,s){this.append(s,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}a.prototype.append=function(t,e){t=p(t),e=y(e);var s=this.map[t];this.map[t]=s?s+", "+e:e},a.prototype.delete=function(t){delete this.map[p(t)]},a.prototype.get=function(t){return t=p(t),this.has(t)?this.map[t]:null},a.prototype.has=function(t){return this.map.hasOwnProperty(p(t))},a.prototype.set=function(t,e){this.map[p(t)]=y(e)},a.prototype.forEach=function(t,e){for(var s in this.map)this.map.hasOwnProperty(s)&&t.call(e,this.map[s],s,this)},a.prototype.keys=function(){var t=[];return this.forEach(function(e,s){t.push(s)}),m(t)},a.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),m(t)},a.prototype.entries=function(){var t=[];return this.forEach(function(e,s){t.push([s,e])}),m(t)},n.iterable&&(a.prototype[Symbol.iterator]=a.prototype.entries);function l(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function g(t){return new Promise(function(e,s){t.onload=function(){e(t.result)},t.onerror=function(){s(t.error)}})}function W(t){var e=new FileReader,s=g(e);return e.readAsArrayBuffer(t),s}function G(t){var e=new FileReader,s=g(e);return e.readAsText(t),s}function z(t){for(var e=new Uint8Array(t),s=new Array(e.length),f=0;f<e.length;f++)s[f]=String.fromCharCode(e[f]);return s.join("")}function R(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function U(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:n.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:n.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:n.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():n.arrayBuffer&&n.blob&&o(t)?(this._bodyArrayBuffer=R(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):n.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||c(t))?this._bodyArrayBuffer=R(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n.blob&&(this.blob=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=l(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(W)}),this.text=function(){var t=l(this);if(t)return t;if(this._bodyBlob)return G(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(z(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(K)}),this.json=function(){return this.text().then(JSON.parse)},this}var X=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function J(t){var e=t.toUpperCase();return X.indexOf(e)>-1?e:t}function E(t,e){if(!(this instanceof E))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var s=e.body;if(t instanceof E){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new a(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!s&&t._bodyInit!=null&&(s=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new a(e.headers)),this.method=J(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&s)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(s),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var f=/([?&])_=[^&]*/;if(f.test(this.url))this.url=this.url.replace(f,"$1_="+new Date().getTime());else{var h=/\?/;this.url+=(h.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})};function K(t){var e=new FormData;return t.trim().split("&").forEach(function(s){if(s){var f=s.split("="),h=f.shift().replace(/\+/g," "),u=f.join("=").replace(/\+/g," ");e.append(decodeURIComponent(h),decodeURIComponent(u))}}),e}function Q(t){var e=new a,s=t.replace(/\r?\n[\t ]+/g," ");return s.split("\r").map(function(f){return f.indexOf(`
`)===0?f.substr(1,f.length):f}).forEach(function(f){var h=f.split(":"),u=h.shift().trim();if(u){var B=h.join(":").trim();e.append(u,B)}}),e}U.call(E.prototype);function v(t,e){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new a(e.headers),this.url=e.url||"",this._initBody(t)}U.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new a(this.headers),url:this.url})},v.error=function(){var t=new v(null,{status:0,statusText:""});return t.type="error",t};var Y=[301,302,303,307,308];v.redirect=function(t,e){if(Y.indexOf(e)===-1)throw new RangeError("Invalid status code");return new v(null,{status:e,headers:{location:t}})},i.DOMException=r.DOMException;try{new i.DOMException}catch(t){i.DOMException=function(e,s){this.message=e,this.name=s;var f=Error(e);this.stack=f.stack},i.DOMException.prototype=Object.create(Error.prototype),i.DOMException.prototype.constructor=i.DOMException}function D(t,e){return new Promise(function(s,f){var h=new E(t,e);if(h.signal&&h.signal.aborted)return f(new i.DOMException("Aborted","AbortError"));var u=new XMLHttpRequest;function B(){u.abort()}u.onload=function(){var w={status:u.status,statusText:u.statusText,headers:Q(u.getAllResponseHeaders()||"")};w.url="responseURL"in u?u.responseURL:w.headers.get("X-Request-URL");var O="response"in u?u.response:u.responseText;setTimeout(function(){s(new v(O,w))},0)},u.onerror=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},u.ontimeout=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},u.onabort=function(){setTimeout(function(){f(new i.DOMException("Aborted","AbortError"))},0)};function Z(w){try{return w===""&&r.location.href?r.location.href:w}catch(O){return w}}u.open(h.method,Z(h.url),!0),h.credentials==="include"?u.withCredentials=!0:h.credentials==="omit"&&(u.withCredentials=!1),"responseType"in u&&(n.blob?u.responseType="blob":n.arrayBuffer&&h.headers.get("Content-Type")&&h.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(u.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof a)?Object.getOwnPropertyNames(e.headers).forEach(function(w){u.setRequestHeader(w,y(e.headers[w]))}):h.headers.forEach(function(w,O){u.setRequestHeader(O,w)}),h.signal&&(h.signal.addEventListener("abort",B),u.onreadystatechange=function(){u.readyState===4&&h.signal.removeEventListener("abort",B)}),u.send(typeof h._bodyInit=="undefined"?null:h._bodyInit)})}D.polyfill=!0,r.fetch||(r.fetch=D,r.Headers=a,r.Request=E,r.Response=v),i.Headers=a,i.Request=E,i.Response=v,i.fetch=D,Object.defineProperty(i,"__esModule",{value:!0})})});var F=_((at,I)=>{M();I.exports=self.fetch.bind(self)});var S=_(A=>{"use strict";var tt=A&&A.__awaiter||function(i,r,n,o){function d(c){return c instanceof n?c:new n(function(p){p(c)})}return new(n||(n=Promise))(function(c,p){function y(l){try{a(o.next(l))}catch(g){p(g)}}function m(l){try{a(o.throw(l))}catch(g){p(g)}}function a(l){l.done?c(l.value):d(l.value).then(y,m)}a((o=o.apply(i,r||[])).next())})};Object.defineProperty(A,"__esModule",{value:!0});A.Nodes=void 0;F();var H=class{constructor(){this.nodeIndex=-1,this.committee=new Set,this.topology=[],this.initTime=0}init(r){return tt(this,void 0,void 0,function*(){this.nodeIndex=-1,this.committee.clear(),this.topology=[],this.initTime=Date.now();let n=[];try{n=yield(yield fetch(r)).json()}catch(o){throw new Error(`exception in fetch(${r}): ${o}`)}for(let o of n)o.Healthy==="1"&&this.topology.push(o);if(this.topology.length===0)throw new Error(`no healthy nodes in ${r}`)})}getHealthyFor(r){var n;let o=[];for(let d of this.topology)d.Weight>0&&((n=d.Mngr)===null||n===void 0?void 0:n.health[r])&&o.push(d);return o}};A.Nodes=H});var V=_((ft,et)=>{et.exports={name:"@orbs-network/ton-access",version:"2.3.1",description:"Unthrottled anonymous RPC access to TON blockchain via a robust decentralized network",source:"lib/index.js",main:"lib/index.js",types:"lib/index.d.ts",files:["lib/**/*"],scripts:{test:"env mocha -r ts-node/register test/**/*.ts","test:v2":"env mocha -r ts-node/register test/ton-v2.ts","test:v4":"env mocha -r ts-node/register test/ton-v4.ts",cleanup:"rimraf ./lib","build:web:reg":"esbuild ./lib/web.js --bundle  --sourcemap --target=es2015 --outfile=./dist/index.js","build:web:min":"esbuild ./lib/web.js --bundle  --minify    --target=es2015 --outfile=./dist/index.min.js","build:web":"rimraf ./dist && npm run build:web:reg && npm run build:web:min",build:"npm run lint && rimraf ./lib && tsc && npm run build:web",format:'prettier --write "src/**/*.ts"',lint:"tslint -p tsconfig.json",prepare:"npm run build",prepublishOnly:"npm test && npm run lint",preversion:"npm run lint",version:"npm run format && git add -A src",postversion:"git push && git push --tags"},repository:{type:"git",url:"git+https://github.com/orbs-network/ton-access.git"},author:"yuval@orbs.com",license:"MIT",bugs:{url:"https://github.com/orbs-network/ton-access/issues"},homepage:"https://github.com/orbs-network/ton-access#readme",dependencies:{"isomorphic-fetch":"^3.0.0"},devDependencies:{"@types/bn.js":"^5.1.1","@types/chai":"^4.3.4","@types/isomorphic-fetch":"^0.0.36","@types/mocha":"^10.0.0",buffer:"^6.0.3",chai:"^4.3.7",esbuild:"^0.15.14",mocha:"^10.1.0",prettier:"^2.7.1",rimraf:"^3.0.2",ton:"^12.1.3","ton-lite-client":"npm:@truecarry/ton-lite-client@^1.6.1",tonweb:"^0.0.58","ts-node":"^10.9.1",tslib:"^2.4.0",tslint:"^6.1.3","tslint-config-prettier":"^1.18.0"}}});var L=_(b=>{"use strict";var T=b&&b.__awaiter||function(i,r,n,o){function d(c){return c instanceof n?c:new n(function(p){p(c)})}return new(n||(n=Promise))(function(c,p){function y(l){try{a(o.next(l))}catch(g){p(g)}}function m(l){try{a(o.throw(l))}catch(g){p(g)}}function a(l){l.done?c(l.value):d(l.value).then(y,m)}a((o=o.apply(i,r||[])).next())})};Object.defineProperty(b,"__esModule",{value:!0});b.getHttpV4Endpoint=b.getHttpV4Endpoints=b.getHttpEndpoint=b.getHttpEndpoints=b.Access=void 0;var rt=S(),x=class{constructor(){this.host="ton.access.orbs.network",this.urlVersion=1,this.nodes=new rt.Nodes}init(){return T(this,void 0,void 0,function*(){let r=V();yield this.nodes.init(`https://${this.host}/mngr/nodes?npm_version=${r.version}`)})}makeProtonet(r,n){let o="";switch(r){case"toncenter-api-v2":o+="v2-";break;case"ton-api-v4":o+="v4-";break}return o+=n,o}weightedRandom(r){let n=0;for(let c of r)n+=c.Weight;let o=Math.floor(Math.random()*n),d=0;for(let c of r){if(o>=d&&o<d+c.Weight)return c;d+=c.Weight}}buildUrls(r,n,o,d){o||(o=""),n||(n="toncenter-api-v2"),r||(r="mainnet"),o.length&&(o=o.replace(/^\/+/,""));let c=[],p=this.makeProtonet(n,r),y=this.nodes.getHealthyFor(p);if(!(y!=null&&y.length))throw new Error(`no healthy nodes for ${p}`);if(d&&y.length){let m=this.weightedRandom(y);if(m)y=[m];else throw new Error("weightedRandom return empty")}for(let m of y){let a=`https://${this.host}/${m.NodeId}/${this.urlVersion}/${r}/${n}`;o.length&&(a+=`/${o}`),c.push(a)}return c}};b.Access=x;function q(i,r,n,o){return T(this,void 0,void 0,function*(){let d=new x;return yield d.init(),d.buildUrls(i,r,n,o)})}function $(i,r){return T(this,void 0,void 0,function*(){let n=i!=null&&i.network?i.network:"mainnet",o="jsonRPC";return(i==null?void 0:i.protocol)==="rest"&&(o=""),yield q(n,"toncenter-api-v2",o,r)})}b.getHttpEndpoints=$;function nt(i){return T(this,void 0,void 0,function*(){return(yield $(i,!0))[0]})}b.getHttpEndpoint=nt;function C(i,r){return T(this,void 0,void 0,function*(){let n=i!=null&&i.network?i.network:"mainnet";if((i==null?void 0:i.protocol)==="json-rpc")throw Error("config.protocol json-rpc is not supported for getTonApiV4Endpoints");return yield q(n,"ton-api-v4","",r)})}b.getHttpV4Endpoints=C;function it(i){return T(this,void 0,void 0,function*(){return(yield C(i,!0))[0]})}b.getHttpV4Endpoint=it});var ot=_(N=>{Object.defineProperty(N,"__esModule",{value:!0});var P=L();window.TonAccess={create:()=>new P.Access,getHttpEndpoint:P.getHttpEndpoint,getHttpV4Endpoint:P.getHttpV4Endpoint}});ot();})();
